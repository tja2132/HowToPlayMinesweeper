{% extends "layout.html" %}

{% block content %}

<script>

    function display_single_pokemon() {
        let pokemon = {{ result | tojson }}
        var $displayDiv = $(".pokemonDisplay");

        const typeWeaknesses = {
            'Normal': 'Fighting',
            'Fire': 'Water',
            'Water': 'Electric',
            'Electric': 'Ground',
            'Grass': 'Fire',
            'Ice': 'Fire',
            'Fighting': 'Psychic',
            'Poison': 'Ground',
            'Ground': 'Water',
            'Flying': 'Electric',
            'Psychic': 'Bug',
            'Bug': 'Fire',
            'Rock': 'Water',
            'Ghost': 'Ghost',
            'Dragon': 'Ice',
            'Dark': 'Fighting',
            'Steel': 'Fire',
            'Fairy': 'Poison',
        };
        
        $displayDiv.empty();

        let id = pokemon.id || 0;
        let previd = id - 1 < 1 ? 1 : id - 1;
        let nextid = id + 1;

        let image = pokemon.image && pokemon.image.hires ? pokemon.image.hires : 'https://raw.githubusercontent.com/Purukitto/pokemon-data.json/master/images/pokedex/hires/001.png';
        let nameEnglish = pokemon.name && pokemon.name.english ? pokemon.name.english : 'N/A';
        let species = pokemon.species || 'N/A';
        let types = pokemon.type ? pokemon.type.join(', ') : 'N/A';
        let description = pokemon.description || 'No description available.';
        let baseStats = pokemon.base ? `HP: ${pokemon.base.HP || 'N/A'}, Attack: ${pokemon.base.Attack || 'N/A'}, Defense: ${pokemon.base.Defense || 'N/A'}, Sp. Attack: ${pokemon.base['Sp. Attack'] || 'N/A'}, Sp. Defense: ${pokemon.base['Sp. Defense'] || 'N/A'}, Speed: ${pokemon.base.Speed || 'N/A'}` : 'N/A';
        let height = pokemon.profile && pokemon.profile.height ? pokemon.profile.height : 'N/A';
        let weight = pokemon.profile && pokemon.profile.weight ? pokemon.profile.weight : 'N/A';
        let eggGroups = pokemon.profile && pokemon.profile.egg ? pokemon.profile.egg.join(', ') : 'N/A';
        let abilities = pokemon.profile && pokemon.profile.ability ? pokemon.profile.ability.map(a => `${a[0]} (${a[1] === "true" ? 'Hidden' : 'Normal'})`).join(', ') : 'N/A';
        let genderRatio = pokemon.profile && pokemon.profile.gender ? pokemon.profile.gender : 'N/A';
        let evolution = pokemon.evolution && pokemon.evolution.next ? `Next - ID: ${pokemon.evolution.next.map(e => e[0]).join(', ')}, Level: ${pokemon.evolution.next.map(e => e[1]).join(', ')}` : 'No further evolution.';
        
        let mainType = types.split(',')[0];
        let weakType = typeWeaknesses[mainType] || "Unknown";
 
        $displayDiv.append(`
        <div class="container">
    <!-- Row for Name, Species, and Image -->
    <div class="row">
        <!-- Name and species column -->
        <div class="col-6">
            <div class="pokemon-header">
            <div class="navigation-buttons">
                <a href="/view/${previd}" id="prevPokemon" class="btn btn-link">&lt;</a>
                <h4>#${id}</h4>
                <a href="/view/${nextid}" id="nextPokemon" class="btn btn-link">&gt;</a>
            </div>
            <h1>${nameEnglish}</h1>
            <h3>The ${species}</h3>
            </div>
        </div>

        <!-- Image column -->
        <div class="col-6 d-flex justify-content-center align-items-center">
            <div class="pokemon-image">
                <img src="${image}" alt="An image of ${nameEnglish}" class="img-fluid">
            </div>
        </div>
    </div>

    <!-- New row for additional information -->
    <div class="row mt-3">
        <div class="col-12">
            <p><strong>Types:</strong> ${types}</p>
            <p><strong>Base Stats:</strong> ${baseStats}</p>
            <p><strong>Height:</strong> ${height}, <strong>Weight:</strong> ${weight}</p>
            <p><strong>Egg Groups:</strong> ${eggGroups}</p>
            <p><strong>Abilities:</strong> ${abilities}</p>
            <p><strong>Gender Ratio:</strong> ${genderRatio}</p>
            <p><strong>Evolution:</strong> ${evolution}</p>
            <p><strong>Description:</strong> ${description}</p>
        </div>
    </div>

    <!-- Row for actions (Find Counters, Find Similar) and edit/delete buttons -->
    <div class="row mt-3">
        <div class="col">
            <div class="pokemon-actions">
                <a class="btn btn-primary" href="/?search=${weakType}" id="findCounters">Find Counters</a>
                <a class="btn btn-primary" href="/?search=${mainType}" id="findSimilar">Find Similar</a>
            </div>
        </div>  

        <div class="col">
            <div class="pokemon-edit">
                <a class="btn btn-secondary" href="/edit/${id}" id="editPokemon">Edit</a>
            </div>
        </div>
    </div>
</div>
    `);
    
    };
</script>

<body onload="display_single_pokemon()"></body>
<div class="countainer">
    <div class="maincontent">
        <div class="pokemonDisplay"></div>
    </div>
</div>


{% endblock %}